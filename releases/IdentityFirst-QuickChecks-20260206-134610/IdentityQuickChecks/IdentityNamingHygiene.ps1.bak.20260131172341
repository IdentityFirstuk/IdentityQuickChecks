<#
    Identity Naming & Hygiene Check
    Detects shared accounts, service accounts named like people, and inconsistent prefixes
#>

param(
    [string]$OutputPath = "."
)

Write-IFQC -Message "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -Level Info
Write-IFQC -Message "  Identity Naming & Hygiene Check" -Level Info
Write-IFQC -Message "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -Level Info
Write-IFQC -Message "" -Level Info
Write-IFQC -Message "  Analyzing naming conventions..." -Level Info
Write-IFQC -Message "" -Level Info

try {
    Import-Module ActiveDirectory -ErrorAction Stop
}
catch {
    Write-IFQC -Message "  âœ— ActiveDirectory module not available" -Level Error
    Write-IFQC -Message "  â„¹ Install RSAT AD tools or run on a Domain Controller" -Level Info
    exit 1
}

$users = Get-ADUser -Filter * -Properties SamAccountName,DisplayName,Description

# Detect inconsistent prefixes
$violations = $users | Where-Object {
    $_.SamAccountName -notmatch "^(svc-|adm-|usr-)" -and
    $_.DisplayName -notmatch "Service|Admin|Test|Temp" -and
    $_.SamAccountName -notmatch "^\$"
}

Write-IFQC -Message "  ğŸ” Checking for naming convention violations..." -Level Info
Write-IFQC -Message "" -Level Info

$violationCount = ($violations | Measure-Object).Count
if ($violationCount -gt 0) {
    Write-IFQC -Message "  âš  Found $violationCount naming violations" -Level Warning
    Write-IFQC -Message "" -Level Info
    $violations | Select-Object SamAccountName,DisplayName | 
        Sort-Object SamAccountName | 
        Select-Object -First 50 | 
        Format-Table -AutoSize
    
    if ($violationCount -gt 50) {
        Write-IFQC -Message "  ... and $($violationCount - 50) more" -Level Info
    }
} else {
    Write-IFQC -Message "  âœ“ No significant naming violations detected" -Level Success
}

# Export report
$timestamp = Get-Date -Format "yyyy-MM-dd_HH-mm-ss"
$jsonPath = Join-Path $OutputPath "IdentityNamingHygiene-$timestamp.json"
$report = @{
    check = "Identity Naming & Hygiene Check"
    timestamp = (Get-Date).ToString("o")
    summary = @{
        totalUsers = ($users | Measure-Object).Count
        violations = $violationCount
    }
    data = $violations | Select-Object SamAccountName,DisplayName
}
$report | ConvertTo-Json -Depth 5 | Out-File -FilePath $jsonPath -Encoding UTF8
Write-IFQC -Message "" -Level Info
Write-IFQC -Message "  ğŸ“„ Report saved: $jsonPath" -Level Info

Write-IFQC -Message "" -Level Info
Write-IFQC -Message "  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€" -Level Info
Write-IFQC -Message "  â„¹  Naming failures correlate to ownership gaps and audit pain." -Level Info
Write-IFQC -Message "     For ownership analysis and lifecycle review, run IdentityHealthCheck." -Level Info
Write-IFQC -Message "  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€" -Level Info

# SIG # Begin signature block
# MIIJyAYJKoZIhvcNAQcCoIIJuTCCCbUCAQExDzANBglghkgBZQMEAgEFADB5Bgor
# BgEEAYI3AgEEoGswaTA0BgorBgEEAYI3AgEeMCYCAwEAAAQQH8w7YFlLCE63JNLG
# KX7zUQIBAAIBAAIBAAIBAAIBADAxMA0GCWCGSAFlAwQCAQUABCBRltQcDnxlmj0Z
# rOaNldu4V8Sn4lkEsrj/aS/pq8MU3KCCBdYwggXSMIIDuqADAgECAhAxVnqog0nQ
# oULr1YncnW59MA0GCSqGSIb3DQEBCwUAMIGAMQswCQYDVQQGEwJHQjEXMBUGA1UE
# CAwOTm9ydGh1bWJlcmxhbmQxFzAVBgNVBAcMDk5vcnRodW1iZXJsYW5kMRowGAYD
# VQQKDBFJZGVudGl0eUZpcnN0IEx0ZDEjMCEGA1UEAwwaSWRlbnRpdHlGaXJzdCBD
# b2RlIFNpZ25pbmcwHhcNMjYwMTI5MjExMDU3WhcNMzEwMTI5MjEyMDU2WjCBgDEL
# MAkGA1UEBhMCR0IxFzAVBgNVBAgMDk5vcnRodW1iZXJsYW5kMRcwFQYDVQQHDA5O
# b3J0aHVtYmVybGFuZDEaMBgGA1UECgwRSWRlbnRpdHlGaXJzdCBMdGQxIzAhBgNV
# BAMMGklkZW50aXR5Rmlyc3QgQ29kZSBTaWduaW5nMIICIjANBgkqhkiG9w0BAQEF
# AAOCAg8AMIICCgKCAgEAtrU2HprgcHe9mxlmt5X72OsSk7cXDyUhoOAcLE9f4lS2
# rOx7VbZSMSi0r4lt8a/S5m/JIWCdYO+GrWZCgS2S73H3KNDszR5HDPbMhv+leoWA
# qLT7C0awpjcTnvWIDxnHyHHane/TNl3ehY9Jek5qrbiNgJDatV6SEYVFlK8Nk9kE
# 3TiveVvRKokNT2xY4/h1rohFCHnF+g7dCn06xAZwoGnFVlmPop3jItAlZdUQz3zR
# /xSNW01sQXgW6/TYd2VzXXuQihMQ3ikjoNGX1L8SlcV4ih2J+r2kSHjhkZ8c+wJE
# v2iiUHqpwmch31UwQOb4qklGKg1A+SAUGdf0cTTc6ApSFsqrol1euObreoy0zdAA
# k47NELuGhKA4N0Dk9Ar616JGFt/03s1waukNisnH/sk9PmPGUo9QtKH1IQpBtwWw
# uKel0w3MmgTwi2vBwfyh2/oTDkTfic7AT3+wh6O/9mFxxu2Fsq6VSlYRpSTSpgxF
# c/YsVlQZaueZs6WB6/HzftGzv1Mmz7is8DNnnhkADTEMj+NDo4wq+lUCE7XNDnnH
# KBN8MkDh4IljXVSkP/xwt4wLLd9g7oAOW91SDA2wJniyjSUy9c+auW3lbA8ybSfL
# TrQgZiSoepcCjW2otZIXrmDnJ7BtqmmiRff4CCacdJXxqNWdFnv6y7Yy6DQmECEC
# AwEAAaNGMEQwDgYDVR0PAQH/BAQDAgeAMBMGA1UdJQQMMAoGCCsGAQUFBwMDMB0G
# A1UdDgQWBBQBfqZy0Xp6lbG6lqI+cAlT7ardlTANBgkqhkiG9w0BAQsFAAOCAgEA
# IwBi/lJTGag5ac5qkMcnyholdDD6H0OaBSFtux1vPIDqNd35IOGYBsquL0BZKh8O
# AHiuaKbo2Ykevpn5nzbXDBVHIW+gN1yu5fWCXSezCPN/NgVgdH6CQ6vIuKNq4BVm
# E8AEhm7dy4pm4WPLqEzWT2fwJhnJ8JYBnPbuUVE8F8acyqG8l3QMcGICG26NWgGs
# A28YvlkzZsny+HAzLvmJn/IhlfWte1kGu0h0G7/KQG6hei5afsn0HxWHKqxI9JsG
# EF3SsMVQW3YJtDzAiRkNtII5k0PyywjrgzIGViVNOrKMT9dKlsTev6Ca/xQX13xM
# 0prtnvxiTXGtT031EBGXAUhOzvx2Hp1WFnZTEIJyX1J2qI+DQsPb9Y1jWcdGBwv3
# /m1nAHE7FpPGsSv+UIP3QQFD/j6nLl5zUoWxqAZMcV4K4t4WkPQjPAXzomoRaqc6
# toXHlXhKHKZ0kfAIcPCFlMwY/Rho82GiATIxHXjB/911VRcpv+xBoPCZkXDnsr9k
# /aRuPNt9DDSrnocJIoTtqIdel/GJmD0D75Lg4voUX9J/1iBuUzta2hoBA8fSVPS5
# 6plrur3Sn5QQG2kJt9I4z5LS3UZSfT+29+xJz7WSyp8+LwU7jaNUuWr3lpUnY2nS
# pohDlw2BFFNGT6/DZ0loRJrUMt58UmfdUX8FPB7uNuIxggNIMIIDRAIBATCBlTCB
# gDELMAkGA1UEBhMCR0IxFzAVBgNVBAgMDk5vcnRodW1iZXJsYW5kMRcwFQYDVQQH
# DA5Ob3J0aHVtYmVybGFuZDEaMBgGA1UECgwRSWRlbnRpdHlGaXJzdCBMdGQxIzAh
# BgNVBAMMGklkZW50aXR5Rmlyc3QgQ29kZSBTaWduaW5nAhAxVnqog0nQoULr1Ync
# nW59MA0GCWCGSAFlAwQCAQUAoIGEMBgGCisGAQQBgjcCAQwxCjAIoAKAAKECgAAw
# GQYJKoZIhvcNAQkDMQwGCisGAQQBgjcCAQQwHAYKKwYBBAGCNwIBCzEOMAwGCisG
# AQQBgjcCARUwLwYJKoZIhvcNAQkEMSIEIKfGCR685saR8OPHjJ8pQAs506GUh6Op
# ZMYmAlcLU7y/MA0GCSqGSIb3DQEBAQUABIICAGblVNxCPqh3LEvMgjHDKXyi2QOF
# z9afFyfEXQrEmqlSErYrwuh47QqjIqJYAYF12E+cCwzhWudXO2ielDgyHo+uLd0+
# AaiA7EdAOvQD9i13HB0cIuZwoTDPXGpF7TmWY/EDfyWQq/0UEcYv+fFLZ9Z5yFw5
# UGCqSnd/Jig5EIbUmzK18KVLeKW/uPE05RXPgibawOqYkc/A5SaMkjfmTKKewM5O
# ejzglW3HiLLZxw0aLe+/HOnvPUcUn1Df3v0zijDQD21HdJxPr1V3xN0aCxHrec8z
# 11Nw7jvCTgqvERK7Wf3D4e7k2ERprGlB8uUjQhq6mgDfP8umc13tGatyG+dxhIfA
# kQi20hd0TE89Iaj89BxAT7hlpvl1x6t3DEdyR3WNjDfKBIoUEGyrI7WkFxwRA5e5
# vJVl/lQ0o4YNzEkXQaQ9dQgbN56vKN7HFPp+heS/k2NsVvXrN1eEyWAs6uZsNznb
# RfTDLfVvXqWCTxygBkKH/C2sHC3MVVF5kEYNSC2L1lWlXNx160gXQFdfqBwZPkYp
# 2e1MFRZPO/AYjBtwZ7HMgLN+9XVs52KcLJ7YhVDZRYDzSGh6dXPFI++Z1WXltnH2
# I7SGZcG8feciZ2QB4N5BjfdGoGDBWyKo+KQnBU8XImwpoF3IpqIqBkMYASx0GG8G
# pSL5daBZeL8Ik/el
# SIG # End signature block
